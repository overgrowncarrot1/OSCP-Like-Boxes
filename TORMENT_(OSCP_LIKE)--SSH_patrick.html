<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>SSH patrick</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>SSH patrick</h1><br/>I ssh&#39;ed in through patrick<br /><br />		At first i did try Patrick, but that did not work with the id_rsa key i had<br />		I then tried patrick and that worked<br />		The password was <strong>mostmachineshaveasupersecurekeyandalongpassphrase</strong> which i got from the tormented printer machine<br />		<br />┌──(kali㉿kali)-[~/Desktop/OSCP_Like_Boxes/Torment]<br />└─$ ssh -i id_rsa Patrick@10.10.10.11                                                                           255 ⨯<br />Enter passphrase for key &#39;id_rsa&#39;: <br />Enter passphrase for key &#39;id_rsa&#39;: <br />Patrick@10.10.10.11: Permission denied (publickey).<br />                                                                                                                      <br />┌──(kali㉿kali)-[~/Desktop/OSCP_Like_Boxes/Torment]<br />└─$ ssh -i id_rsa patrick@10.10.10.11                                                                           255 ⨯<br />Enter passphrase for key &#39;id_rsa&#39;: <br />Linux TORMENT 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64<br /><br />The programs included with the Debian GNU/Linux system are free software;<br />the exact distribution terms for each program are described in the<br />individual files in /usr/share/doc/*/copyright.<br /><br />Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br />permitted by applicable law.<br />Last login: Sat Feb 27 06:13:58 2021 from 10.10.10.15<br />patrick@TORMENT:~$ <br /><br />patrick@TORMENT:~$ sudo -l<br />Matching Defaults entries for patrick on TORMENT:<br />    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br /><br />User patrick may run the following commands on TORMENT:<br />    (ALL) NOPASSWD: /bin/systemctl poweroff, /bin/systemctl halt, /bin/systemctl reboot<br /><br />Looks like I can poweroff, halt and reboot<br /><br />I remember doing a THM where I could only do a reboot and a cronjob would run, lets see if this is the same concept<br /><br />^Cpatrick@TORMENT:~$ crontab -h<br />crontab: invalid option -- &#39;h&#39;<br />crontab: usage error: unrecognized option<br />usage:	crontab [-u user] file<br />	crontab [ -u user ] [ -i ] { -e | -l | -r }<br />		(default operation is replace, per 1003.2)<br />	-e	(edit user&#39;s crontab)<br />	-l	(list user&#39;s crontab)<br />	-r	(delete user&#39;s crontab)<br />	-i	(prompt before deleting user&#39;s crontab)<br />patrick@TORMENT:~$ crontab -l<br />no crontab for patrick<br />patrick@TORMENT:~$ <br /><br />I guess not...<br /><br />That is ok, lets put linpeas in there and see if we see anything out of place<br /><br />┌──(kali㉿kali)-[~/Desktop/OSCP_Like_Boxes/Torment]<br />└─$ scp -i id_rsa linpeas.sh patrick@10.10.10.11:/home/patrick    <br />Enter passphrase for key &#39;id_rsa&#39;: <br />linpeas.sh                                                                         100%  318KB  97.2MB/s   00:00    <br />                                                                                                                     <br />┌──(kali㉿kali)-[~/Desktop/OSCP_Like_Boxes/Torment]<br />└─$ <br /><br />Lets run linpeas<br /><br />Looking in the linpeas file you will see the same information, I continued to see apache2.conf in there<br /><br />When looking through what I could do I found another user, which was also in my username list but did not show up when in enumarated employees<br /><br />patrick@TORMENT:/home$ ls -la<br />total 16<br />drwxr-xr-x  4 root    root    4096 Dec 27  2018 .<br />drwxr-xr-x 23 root    root    4096 Jan  4  2019 ..<br />drwx------  5 patrick patrick 4096 Feb 27 06:22 patrick<br />drwx------ 18 qiu     qiu     4096 Jan  4  2019 qiu<br />patrick@TORMENT:/home$ <br /><br />I tried to go into qiu and it did not work, why?<br /><br />From here I also noticed I spelled his name wrong in the username list and fixed that<br /><br />Lets go to that conf. file and see what if there is anything in there I can change<br /><br />patrick@TORMENT:/etc/apache2$ cat /etc/apache2/apache2.conf <br /># This is the main Apache server configuration file.  It contains the<br /># configuration directives that give the server its instructions.<br /># See http://httpd.apache.org/docs/2.4/ for detailed information about<br /># the directives and /usr/share/doc/apache2/README.Debian about Debian specific<br /># hints.<br />#<br />#<br /># Summary of how the Apache 2 configuration works in Debian:<br /># The Apache 2 web server configuration in Debian is quite different to<br /># upstream&#39;s suggested way to configure the web server. This is because Debian&#39;s<br /># default Apache2 installation attempts to make adding and removing modules,<br /># virtual hosts, and extra configuration directives as flexible as possible, in<br /># order to make automating the changes and administering the server as easy as<br /># possible.<br /><br /># It is split into several files forming the configuration hierarchy outlined<br /># below, all located in the /etc/apache2/ directory:<br />#<br />#	/etc/apache2/<br />#	|-- apache2.conf<br />#	|	`--  ports.conf<br />#	|-- mods-enabled<br />#	|	|-- *.load<br />#	|	`-- *.conf<br />#	|-- conf-enabled<br />#	|	`-- *.conf<br /># 	`-- sites-enabled<br />#	 	`-- *.conf<br />#<br />#<br /># * apache2.conf is the main configuration file (this file). It puts the pieces<br />#   together by including all remaining configuration files when starting up the<br />#   web server.<br />#<br /># * ports.conf is always included from the main configuration file. It is<br />#   supposed to determine listening ports for incoming connections which can be<br />#   customized anytime.<br />#<br /># * Configuration files in the mods-enabled/, conf-enabled/ and sites-enabled/<br />#   directories contain particular configuration snippets which manage modules,<br />#   global configuration fragments, or virtual host configurations,<br />#   respectively.<br />#<br />#   They are activated by symlinking available configuration files from their<br />#   respective *-available/ counterparts. These should be managed by using our<br />#   helpers a2enmod/a2dismod, a2ensite/a2dissite and a2enconf/a2disconf. See<br />#   their respective man pages for detailed information.<br />#<br /># * The binary is called apache2. Due to the use of environment variables, in<br />#   the default configuration, apache2 needs to be started/stopped with<br />#   /etc/init.d/apache2 or apache2ctl. Calling /usr/bin/apache2 directly will not<br />#   work with the default configuration.<br /><br /><br /># Global configuration<br />#<br /><br />#<br /># ServerRoot: The top of the directory tree under which the server&#39;s<br /># configuration, error, and log files are kept.<br />#<br /># NOTE!  If you intend to place this on an NFS (or otherwise network)<br /># mounted filesystem then please read the Mutex documentation (available<br /># at &lt;URL:http://httpd.apache.org/docs/2.4/mod/core.html#mutex&gt;);<br /># you will save yourself a lot of trouble.<br />#<br /># Do NOT add a slash at the end of the directory path.<br />#<br />#ServerRoot &quot;/etc/apache2&quot;<br /><br />#<br /># The accept serialization lock file MUST BE STORED ON A LOCAL DISK.<br />#<br />#Mutex file:${APACHE_LOCK_DIR} default<br /><br />#<br /># The directory where shm and other runtime files will be stored.<br />#<br /><br />DefaultRuntimeDir ${APACHE_RUN_DIR}<br /><br />#<br /># PidFile: The file in which the server should record its process<br /># identification number when it starts.<br /># This needs to be set in /etc/apache2/envvars<br />#<br />PidFile ${APACHE_PID_FILE}<br /><br />#<br /># Timeout: The number of seconds before receives and sends time out.<br />#<br />Timeout 300<br /><br />#<br /># KeepAlive: Whether or not to allow persistent connections (more than<br /># one request per connection). Set to &quot;Off&quot; to deactivate.<br />#<br />KeepAlive On<br /><br />#<br /># MaxKeepAliveRequests: The maximum number of requests to allow<br /># during a persistent connection. Set to 0 to allow an unlimited amount.<br /># We recommend you leave this number high, for maximum performance.<br />#<br />MaxKeepAliveRequests 100<br /><br />#<br /># KeepAliveTimeout: Number of seconds to wait for the next request from the<br /># same client on the same connection.<br />#<br />KeepAliveTimeout 5<br /><br /><br /># These need to be set in /etc/apache2/envvars<br />User ${APACHE_RUN_USER}<br />Group ${APACHE_RUN_GROUP}<br /><br />#<br /># HostnameLookups: Log the names of clients or just their IP addresses<br /># e.g., www.apache.org (on) or 204.62.129.132 (off).<br /># The default is off because it&#39;d be overall better for the net if people<br /># had to knowingly turn this feature on, since enabling it means that<br /># each client request will result in AT LEAST one lookup request to the<br /># nameserver.<br />#<br />HostnameLookups Off<br /><br /># ErrorLog: The location of the error log file.<br /># If you do not specify an ErrorLog directive within a &lt;VirtualHost&gt;<br /># container, error messages relating to that virtual host will be<br /># logged here.  If you *do* define an error logfile for a &lt;VirtualHost&gt;<br /># container, that host&#39;s errors will be logged there and not here.<br />#<br />ErrorLog ${APACHE_LOG_DIR}/error.log<br /><br />#<br /># LogLevel: Control the severity of messages logged to the error_log.<br /># Available values: trace8, ..., trace1, debug, info, notice, warn,<br /># error, crit, alert, emerg.<br /># It is also possible to configure the log level for particular modules, e.g.<br /># &quot;LogLevel info ssl:warn&quot;<br />#<br />LogLevel warn<br /><br /># Include module configuration:<br />IncludeOptional mods-enabled/*.load<br />IncludeOptional mods-enabled/*.conf<br /><br /># Include list of ports to listen on<br />Include ports.conf<br /><br /><br /># Sets the default security model of the Apache2 HTTPD server. It does<br /># not allow access to the root filesystem outside of /usr/share and /var/www.<br /># The former is used by web applications packaged in Debian,<br /># the latter may be used for local directories served by the web server. If<br /># your system is serving content from a sub-directory in /srv you must allow<br /># access here, or in any related virtual host.<br />&lt;Directory /&gt;<br />	Options FollowSymLinks<br />	AllowOverride None<br />	Require all denied<br />&lt;/Directory&gt;<br /><br />&lt;Directory /usr/share&gt;<br />	AllowOverride None<br />	Require all granted<br />&lt;/Directory&gt;<br /><br />&lt;Directory /var/www/&gt;<br />	Options Indexes FollowSymLinks<br />	AllowOverride None<br />	Require all granted<br />&lt;/Directory&gt;<br /><br />#&lt;Directory /srv/&gt;<br />#	Options Indexes FollowSymLinks<br />#	AllowOverride None<br />#	Require all granted<br />#&lt;/Directory&gt;<br /><br /><br /><br /><br /># AccessFileName: The name of the file to look for in each directory<br /># for additional configuration directives.  See also the AllowOverride<br /># directive.<br />#<br />AccessFileName .htaccess<br /><br />#<br /># The following lines prevent .htaccess and .htpasswd files from being<br /># viewed by Web clients.<br />#<br />&lt;FilesMatch &quot;^\.ht&quot;&gt;<br />	Require all denied<br />&lt;/FilesMatch&gt;<br /><br /><br />#<br /># The following directives define some format nicknames for use with<br /># a CustomLog directive.<br />#<br /># These deviate from the Common Log Format definitions in that they use %O<br /># (the actual bytes sent including headers) instead of %b (the size of the<br /># requested file), because the latter makes it impossible to detect partial<br /># requests.<br />#<br /># Note that the use of %{X-Forwarded-For}i instead of %h is not recommended.<br /># Use mod_remoteip instead.<br />#<br />LogFormat &quot;%v:%p %h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; vhost_combined<br />LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined<br />LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O&quot; common<br />LogFormat &quot;%{Referer}i -&gt; %U&quot; referer<br />LogFormat &quot;%{User-agent}i&quot; agent<br /><br /># Include of directories ignores editors&#39; and dpkg&#39;s backup files,<br /># see README.Debian for details.<br /><br /># Include generic snippets of statements<br />IncludeOptional conf-enabled/*.conf<br /><br /># Include the virtual host configurations:<br />IncludeOptional sites-enabled/*.conf<br /><br /># vim: syntax=apache ts=4 sw=4 sts=4 sr noet<br />patrick@TORMENT:/etc/apache2$ <br /><br />When looking through it i saw some users and groups, I decided to add qiu to the user and group to see if we can get him to run the apache2 server when it restarted, thus allowing for a reverse shell and finally getting in through qiu privs<br /><br /># MaxKeepAliveRequests: The maximum number of requests to allow<br /># during a persistent connection. Set to 0 to allow an unlimited amount.<br /># We recommend you leave this number high, for maximum performance.<br />#<br />MaxKeepAliveRequests 100<br /><br />#<br /># KeepAliveTimeout: Number of seconds to wait for the next request from the<br /># same client on the same connection.<br />#<br />KeepAliveTimeout 5<br /><br /><br /><strong># These need to be set in /etc/apache2/envvars<br />User ${APACHE_RUN_USER}<br />Group ${APACHE_RUN_GROUP}<br />User qiu<br />Group qiu</strong><br /><br /><br />#<br /># HostnameLookups: Log the names of clients or just their IP addresses<br /># e.g., www.apache.org (on) or 204.62.129.132 (off).<br /># The default is off because it&#39;d be overall better for the net if people<br /># had to knowingly turn this feature on, since enabling it means that<br /># each client request will result in AT LEAST one lookup request to the<br /># nameserver.<br />#<br />HostnameLookups Off<br /><br /></div></body></html>